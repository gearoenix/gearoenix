name: 'Windows-2022  '
on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: windows-latest
    container:
      image: noroozpour/gearoenix:windows-0.1
    defaults:
      run:
        shell: powershell
    steps:
      - uses: actions/checkout@v3
      - name: Setup cache
        uses: actions/cache@v3
        id: cache
        with:
          path: |
            build-release/
            build-debug/
          key: ${{ runner.os }}-windows-gearoenix-${{ hashFiles('.github/workflows/windows.yml') }}
      - name: Echo settings
        run: |
          Write-Host "Path: $env:Path"
          Write-Host "CMake thread option: $env:CMAKE_BUILD_PARALLEL_LEVEL"
      - name: Release build
        run: |
          New-Item -ItemType Directory -Force -Path build-release
          Set-Location -Path build-release
          cmake ..
          cmake --build . --config Release
      - name: Building debug and tests
        run: |
          New-Item -ItemType Directory -Force -Path build-debug
          Set-Location -Path build-debug
          cmake ..
          cmake --build . --config Debug
          Set-Location -Path tests
          Set-Location -Path Debug
          .\GearoenixGameEngineTests.exe
